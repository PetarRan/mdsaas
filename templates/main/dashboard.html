<!DOCTYPE html>
<html>

<head>
    <title>User Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">
            <img src="{{ url_for('static', filename='banner-dark.png') }}" width="auto" height="30" alt="Logo">
        </a>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="fa fa-sign-out" aria-hidden="true"></i> Logout
                </a>
            </li>
        </ul>
    </nav>

    <section>
        <div class="row" style="height: 90vh;">
            <div class="col-md-10 col-sm-8 col-9">
                <h2 class="mx-2 my-2">Welcome, [USERNAME]</h2>
                <div class="modal fade" id="uploadConfirmationModal" tabindex="-1" role="dialog"
                    aria-labelledby="uploadConfirmationModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="uploadConfirmationModalLabel">Upload Confirmation</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body" id="uploadConfirmationBody">
                                <p>Selected files:</p>
                                <ul id="selectedFilesList"></ul>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" id="confirmUploadButton">Upload</button>
                            </div>
                        </div>
                    </div>
                </div>
                <ul class="nav nav-tabs" id="myTabs" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="documents-tab" data-toggle="tab" href="#documents" role="tab"
                            aria-controls="documents" aria-selected="true">Documents</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="summaries-tab" data-toggle="tab" href="#summaries" role="tab"
                            aria-controls="summaries" aria-selected="false">Summaries</a>
                    </li>
                </ul>

                <!-- Tab content -->
                <div class="tab-content" id="myTabsContent" style="height:100%;">
                    <div class="tab-pane fade show active" id="documents" role="tabpanel"
                        aria-labelledby="documents-tab" style="height:100%;">
                        <div class="d-flex flex-row flex-wrap mt-4" style="height:100%;" id="document-container">
                            <!-- Dummy Card -->
                            <div class="card m-2 custom-card" id="dummy-card"
                                style="max-width: 350px; min-width: 350px; max-height: 250px;">
                                <div class="card-body">
                                    <div class="custom-control custom-checkbox" style="text-align: end;">
                                        <input type="checkbox" class="custom-control-input checkbox-on-card"
                                            id="customCheck1">
                                        <label class="custom-control-label" for="customCheck1"></label>
                                    </div>
                                    <h5 class="card-title"
                                        style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Document
                                        Name
                                    </h5>
                                    <p class="card-text">Date Uploaded: January 1, 2023</p>
                                    <p class="card-text">Document type: PDF</p>
                                    <button class="btn btn-outline-primary view-document"><i
                                            class="fa fa-eye"></i>&nbsp;View
                                        Document</button>
                                    <button class="btn btn-outline-danger"> <i
                                            class="fa fa-trash"></i>&nbsp;Delete</button>
                                </div>
                            </div>
                            <!-- Add more cards as needed -->
                        </div>
                    </div>
                    <div class="tab-pane fade" id="summaries" role="tabpanel" aria-labelledby="summaries-tab">
                        <div class="d-flex flex-row flex-wrap mt-4" id="summaries-container">
                            <div class="card m-2" id="dummy-summary-card" style="max-width: 350px; min-width: 350px;">
                                <div class="card-body">
                                    <h5 class="card-title"
                                        style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Summary
                                        Title</h5>
                                    <p class="card-text">Date Created: January 1, 2023</p>
                                    <p class="card-text">Summarization Method: SpaCy</p>
                                    <button class="btn btn-outline-info view-summary-button"><i
                                            class="fa fa-eye"></i>&nbsp;View
                                        Summary</button>
                                    <button class="btn btn-outline-danger"> <i
                                            class="fa fa-trash"></i>&nbsp;Delete</button>
                                </div>
                            </div>
                            <!-- Add more cards as needed -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-2 col-sm-4 col-3 bg-light" id="user-menu">
                <div class="form-group mt-4 mx-2">
                    <div class="custom-file mb-5">
                        <input type="file" class="custom-file-input" id="fileInput" multiple>
                        <label class="custom-file-label" for="fileInput">Choose files</label>
                    </div>
                    <label for="summarization-method">Select Summarization Method</label>
                    <select class="form-control" id="summarization-method" disabled>
                        <option value="spacy">SpaCy</option>
                        <option value="nltk">NLTK</option>
                        <!-- Add more options as needed -->
                    </select>
                </div>
                <button id="summarize-button" class="btn btn-primary mx-2" disabled>Summarize</button>
            </div>
        </div>
    </section>
    </div>

    <script>
        const documentContainer = document.getElementById("document-container");
        const summariesContainer = document.getElementById("summaries-container");
        const selectSummarizeButton = document.getElementById("summarize-button");
        const summarizationMethodSelect = document.getElementById("summarization-method");

        const cards = documentContainer.getElementsByClassName("card");
        const selectedCards = new Set();

        const fileInput = document.getElementById("fileInput");
        const uploadConfirmationModal = document.getElementById("uploadConfirmationModal");
        const selectedFilesList = document.getElementById("selectedFilesList");
        const confirmUploadButton = document.getElementById("confirmUploadButton");
        const uploadConfirmationBody = document.getElementById("uploadConfirmationBody");

        // Add a click event listener to each card
        for (const card of cards) {
            const checkbox = card.querySelector("input[type='checkbox']");

            // Toggle selection when the card or its associated checkbox is clicked
            card.addEventListener("click", (event) => {
                toggleSelection(card, checkbox);
            });

            checkbox.addEventListener("click", (event) => {
                toggleSelection(card, checkbox);
            });
        }

        function toggleSelection(card, checkbox) {
            card.classList.toggle("selected");
            checkbox.checked = card.classList.contains("selected");

            // Add or remove the card from the set of selected cards
            if (card.classList.contains("selected")) {
                selectedCards.add(card);
            } else {
                selectedCards.delete(card);
            }

            // Enable or disable the options based on the selected card count
            if (selectedCards.size > 0) {
                selectSummarizeButton.disabled = false;
                summarizationMethodSelect.disabled = false;
            } else {
                selectSummarizeButton.disabled = true;
                summarizationMethodSelect.disabled = true;
            }
        }

        // Update the modal content when clicking "View Document"
        const viewDocumentButtons = documentContainer.querySelectorAll(".view-document");
        viewDocumentButtons.forEach((button, index) => {
            button.addEventListener("click", (event) => {
                const card = button.closest(".card");
                const documentName = card.querySelector(".card-title").textContent;
                // Here you can load the document content and set it in the modal body
                const documentContent = "This is the content of the document.";
                showDocumentInModal(documentName, documentContent);
            });
        });

        // Update the modal content when clicking "View Summary"
        const viewSummaryButtons = summariesContainer.querySelectorAll(".view-summary-button");
        viewSummaryButtons.forEach((button, index) => {
            button.addEventListener("click", (event) => {
                const card = button.closest(".card");
                const summaryTitle = card.querySelector(".card-title").textContent;
                // Here you can load the summary content and set it in the modal body
                const summaryContent = "This is the content of the summary.";
                showDocumentInModal(summaryTitle, summaryContent);
            });
        });

        function showDocumentInModal(title, content) {
            const documentModal = document.getElementById("documentModal");
            const modalTitle = documentModal.querySelector(".modal-title");
            const modalBody = documentModal.querySelector(".modal-body");

            modalTitle.textContent = title;
            modalBody.textContent = content;

            $(documentModal).modal("show");
        }

        // Add a change event listener to handle file selection from the file input
        fileInput.addEventListener("change", (event) => {
            const files = event.target.files;
            selectedFilesList.innerHTML = "";
            for (let i = 0; i < files.length; i++) {
                const li = document.createElement("li");
                li.textContent = files[i].name;
                selectedFilesList.appendChild(li);
            }

            // Show the confirmation modal
            $(uploadConfirmationModal).modal("show");
        });

        // Add a click event listener to confirm the upload
        confirmUploadButton.addEventListener("click", () => {
            // You can implement file upload logic here.
            // For example, you can use FormData to send the files to the server via AJAX.
            // This code is just an example and should be replaced with your actual upload logic.

            const formData = new FormData();
            const files = fileInput.files;

            for (let i = 0; i < files.length; i++) {
                formData.append("file[]", files[i]);
            }

            // Send the formData to the server for actual file upload
            // Replace this with your server-side upload endpoint
            // Example AJAX call:
            // fetch('/upload', {
            //     method: 'POST',
            //     body: formData
            // })
            //     .then(response => {
            //         if (response.ok) {
            //             // File(s) uploaded successfully
            //             // You can handle the response here
            //         } else {
            //             // Error handling
            //         }
            //     });

            // Hide the confirmation modal
            $(uploadConfirmationModal).modal("hide");
        });
    </script>
</body>

<div class="modal fade" id="documentModal" tabindex="-1" role="dialog" aria-labelledby="documentModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="documentModalLabel">Document Title / Summary Title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<style>
    html,
    body {
        width: 100%;
        height: 100%;
        margin: 0px;
        padding: 0px;
        overflow-x: hidden;
    }
</style>

</html>